---
title: "Curate dataset"
date: "`r Sys.Date()`"
bibliography: references.bib
biblio-style: apalike
---

## About

### Description

<!-- The aim of this script -->

JF: make sure to add prose description to document your processing steps and their results!

### Usage

<!-- How to run this script: what input it requires and output produced -->

## Setup

JF: note you should only load the packages that are necessary to complete the processing steps for this script!

```{r setup}
# Script-specific options or packages
library(robotstxt) # web scraping robots
library(tidyverse) # data manipulation
library(readtext) # read files
library(tidytext) # separate text
library(rvest) 
library(dplyr)


paths_allowed(paths = "https://www.last.fm/") # check permissions
#> [1] TRUE
source("../functions/acquire_data_functions.R")
```

## Run

```{r glimpse-pop}
lastfm <- 
  readtext(file = "../data/original/lastfm/*.csv", # files to match using *.csv
           text_field = "lyrics") %>% # text column from the datasets
  as_tibble() %>%  # convert to a tibble
  select(-doc_id, -lyrics_url) # keep key variables

glimpse(lastfm)


```

```{r Collapse}
  
 lastfm <- 
  lastfm %>% # # read_csv(file = "../data/original/lastfm/pop_lyrics.csv") # you've already read the data in
  group_by(artist, song, genre) %>% # grouping
  summarise(lyrics = str_flatten(text, collapse = " ")) %>%  # collapse text into the new column `lyrics` (dropping `text`)
  ungroup() # unset the groupings



glimpse(lastfm) # preview
```
```{r Arrange}
lastfm <- 
  lastfm %>% # original dataset
  select(artist, song, lyrics, genre) %>% # order columns (and rename `text` to `lyrics`)
  arrange(genre, artist) # arrange rows by `genre` and `artist`

lastfm %>% # curated dataset
  slice_head(n = 5) %>% # first 5 observations
  knitr::kable(booktabs = TRUE, # print pretty table
               captions = "Sample lyrics from curated Last.fm dataset.") # add caption to the table
```
```{r Write}
fs::dir_create(path = "../data/derived/lastfm/") # create lastfm subdirectory
write_csv(lastfm, 
          file = "../data/derived/lastfm/lastfm_curated.csv") # write lastfm to disk and label as the curated dataset
```

JF: you will want to save the results of your curation process in the `../data/derived/` directory.
JF: you will also want to create the data dictionary for this curated dataset.

## Finalize

### Log

<!-- Any description that will be helpful to understand the results of this script and how it contributes to the aims of the project -->

### Session

<details><summary>View session information</summary>

```{r, child="_session-info.Rmd"}
```

</details>

```{r cleanup, echo=FALSE}
rm(list = ls()) # clean working environment
```

## References
